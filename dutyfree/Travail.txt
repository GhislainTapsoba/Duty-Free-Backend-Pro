4. Configuration des Secrets
GitHub Secrets √† configurer
bash# Docker Hub
DOCKER_USERNAME
DOCKER_PASSWORD

# SonarCloud
SONAR_TOKEN

# SSH Keys
SSH_PRIVATE_KEY_STAGING
SSH_USER_STAGING
SSH_HOST_STAGING
SSH_PRIVATE_KEY_PROD
SSH_USER_PROD
SSH_HOST_PROD

# Slack
SLACK_WEBHOOK
GitLab CI/CD Variables
bash# Docker Registry
CI_REGISTRY_USER
CI_REGISTRY_PASSWORD

# SonarQube
SONAR_HOST_URL
SONAR_TOKEN

# SSH
SSH_PRIVATE_KEY_STAGING
STAGING_USER
STAGING_HOST
SSH_PRIVATE_KEY_PROD
PROD_USER
PROD_HOST

üöÄ EX√âCUTION DU PROJET
Parfait ! Allons-y √©tape par √©tape pour ex√©cuter le projet.
üìù Checklist Avant Ex√©cution
bash# 1. V√©rifier que vous √™tes dans le bon r√©pertoire
pwd
# Devrait afficher: /votre/chemin/duty-free-backend

# 2. V√©rifier la structure des fichiers
ls -la
üîß √âTAPE 1 : Configuration Initiale
bash# Rendre les scripts ex√©cutables
chmod +x *.sh

# Ex√©cuter le script de setup
./setup.sh
Cela va cr√©er :

Les r√©pertoires n√©cessaires (logs, backups, uploads)
Le fichier .env depuis .env.example
G√©n√©rer un secret JWT

‚öôÔ∏è √âTAPE 2 : Configuration de l'Environnement
√âditez le fichier .env qui vient d'√™tre cr√©√© :
bashnano .env
# ou
vim .env
# ou utilisez votre √©diteur pr√©f√©r√©
V√©rifiez/modifiez ces variables :
env# Database
DB_NAME=dutyfree_db
DB_USER=postgres
DB_PASSWORD=postgres

# Redis
REDIS_PASSWORD=redis_password

# JWT (d√©j√† g√©n√©r√© automatiquement)
JWT_SECRET=<g√©n√©r√©_automatiquement>

# Application
SPRING_PROFILES_ACTIVE=dev
TZ=Africa/Ouagadougou
üê≥ √âTAPE 3 : D√©marrage avec Docker (Recommand√©)
Option A : Mode D√©veloppement
bash# D√©marrer tous les services
make dev

# Ou sans Makefile
docker-compose up -d
Option B : Mode Production
bash# Build et d√©marrer
make prod-build

# Ou sans Makefile
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d --build
üìä √âTAPE 4 : V√©rification du D√©marrage
bash# V√©rifier que tous les containers sont d√©marr√©s
docker-compose ps

# Devrait afficher quelque chose comme :
# NAME                   STATUS          PORTS
# dutyfree-postgres      Up             0.0.0.0:5432->5432/tcp
# dutyfree-redis         Up             0.0.0.0:6379->6379/tcp
# dutyfree-app           Up (healthy)   0.0.0.0:8080->8080/tcp
üîç √âTAPE 5 : V√©rifier les Logs
bash# Voir tous les logs
make logs

# Voir seulement les logs de l'application
make logs-app

# Ou sans Makefile
docker-compose logs -f app
```

**Attendez de voir ce message dans les logs :**
```
Started DutyFreeApplication in X.XXX seconds
‚úÖ √âTAPE 6 : Health Check
bash# V√©rifier la sant√© de l'application
./health-check.sh

# Ou manuellement
curl http://localhost:8080/actuator/health
R√©ponse attendue :
json{
  "status": "UP"
}
```

### üåê √âTAPE 7 : Acc√©der √† l'Application

Ouvrez votre navigateur et acc√©dez √† :

1. **Swagger UI (Documentation API Interactive)**
```
   http://localhost:8080/swagger-ui.html
```

2. **API Documentation JSON**
```
   http://localhost:8080/api-docs
```

3. **Health Check**
```
   http://localhost:8080/actuator/health
üß™ √âTAPE 8 : Tester l'API
Test 1 : Login
bashcurl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin123"
  }'
R√©ponse attendue :
json{
  "success": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "type": "Bearer",
    "userId": 1,
    "username": "admin",
    "fullName": "System Administrator",
    "role": "ADMIN"
  },
  "timestamp": "2024-12-15T10:30:00"
}
üí° Copiez le token pour les requ√™tes suivantes !
Test 2 : R√©cup√©rer les Produits
bash# Remplacez YOUR_TOKEN par le token re√ßu
curl -X GET http://localhost:8080/api/products \
  -H "Authorization: Bearer YOUR_TOKEN"
Test 3 : Cr√©er une Vente
bashcurl -X POST http://localhost:8080/api/sales \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "cashRegisterId": 1,
    "items": [
      {
        "productId": 1,
        "quantity": 2
      }
    ],
    "payments": [
      {
        "paymentMethod": "CASH",
        "currency": "XOF",
        "amount": 30000
      }
    ]
  }'
üìä √âTAPE 9 : Acc√©der √† PgAdmin (Optionnel)
Si vous voulez g√©rer la base de donn√©es visuellement :
bash# D√©marrer PgAdmin
docker-compose --profile dev up -d pgadmin

# Acc√©der √† PgAdmin
# URL: http://localhost:5050
# Email: admin@dutyfree.com
# Password: admin
Configuration de la connexion PostgreSQL dans PgAdmin :

Host: postgres
Port: 5432
Database: dutyfree_db
Username: postgres
Password: postgres

üõ†Ô∏è COMMANDES UTILES
bash# Arr√™ter l'application
make stop
# ou
docker-compose down

# Red√©marrer l'application
make restart
# ou
docker-compose restart

# Voir l'√©tat des services
make status
# ou
docker-compose ps

# Voir les statistiques de ressources
make stats
# ou
docker stats

# Acc√©der au shell de l'application
make shell-app
# ou
docker-compose exec app sh

# Acc√©der √† la base de donn√©es
make shell-db
# ou
docker-compose exec postgres psql -U postgres -d dutyfree_db

# Cr√©er un backup
./backup.sh
# ou
make backup-db

# Nettoyer tout (‚ö†Ô∏è ATTENTION : supprime les donn√©es)
make clean
# ou
docker-compose down -v
üîß √âTAPE 10 : Alternative - D√©marrage Sans Docker
Si vous pr√©f√©rez ex√©cuter sans Docker (pour le d√©veloppement) :
1. Installer PostgreSQL localement
bash# Ubuntu/Debian
sudo apt-get install postgresql-15

# macOS
brew install postgresql@15

# Cr√©er la base de donn√©es
createdb dutyfree_db
2. Installer Redis localement
bash# Ubuntu/Debian
sudo apt-get install redis-server

# macOS
brew install redis

# D√©marrer Redis
redis-server
3. Configurer application-dev.yml
yamlspring:
  datasource:
    url: jdbc:postgresql://localhost:5432/dutyfree_db
    username: postgres
    password: postgres
  
  redis:
    host: localhost
    port: 6379
4. D√©marrer l'application
bash# Avec Maven
mvn spring-boot:run

# Ou apr√®s compilation
mvn clean package -DskipTests
java -jar target/duty-free-backend-1.0.0.jar
üêõ D√âPANNAGE
Probl√®me 1 : Port 8080 d√©j√† utilis√©
bash# Trouver le processus
lsof -i :8080

# Tuer le processus
kill -9 <PID>

# Ou changer le port dans docker-compose.yml
ports:
  - "8081:8080"  # Utiliser 8081 √† la place
Probl√®me 2 : Les containers ne d√©marrent pas
bash# Voir les logs d'erreur
docker-compose logs

# Recr√©er les containers
docker-compose down -v
docker-compose up -d --build
Probl√®me 3 : Erreur de connexion √† la base de donn√©es
bash# V√©rifier que PostgreSQL est d√©marr√©
docker-compose ps postgres

# Voir les logs PostgreSQL
docker-compose logs postgres

# Red√©marrer PostgreSQL
docker-compose restart postgres
Probl√®me 4 : Erreur lors des migrations Flyway
bash# Voir le statut des migrations
mvn flyway:info

# R√©parer Flyway
mvn flyway:repair

# Ou se connecter √† la DB et v√©rifier
docker-compose exec postgres psql -U postgres -d dutyfree_db
\dt  # Liste les tables
üì∏ √âTAPE 11 : V√©rifier que Tout Fonctionne
Ex√©cutez ces commandes pour confirmer :
bash# 1. Health check
curl http://localhost:8080/actuator/health

# 2. Swagger UI accessible
curl -I http://localhost:8080/swagger-ui.html

# 3. Login fonctionne
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'

# 4. Base de donn√©es accessible
docker-compose exec postgres psql -U postgres -d dutyfree_db -c "SELECT COUNT(*) FROM users;"

# 5. Redis fonctionne
docker-compose exec redis redis-cli ping
Si toutes ces commandes fonctionnent, f√©licitations ! üéâ
üìö PROCHAINES √âTAPES
Maintenant que l'application fonctionne :

Testez les endpoints via Swagger UI
Cr√©ez des donn√©es de test (produits, ventes, etc.)
Testez les rapports
Configurez votre frontend pour se connecter √† l'API

üÜò BESOIN D'AIDE ?
Si vous rencontrez des probl√®mes :
bash# R√©cup√©rer tous les logs
docker-compose logs > logs/all-logs.txt

# V√©rifier la configuration
cat .env

# V√©rifier l'√©tat d√©taill√©
docker-compose ps -a
docker inspect dutyfree-app

Dites-moi o√π vous en √™tes et si vous rencontrez des probl√®mes ! üöÄ
Quelle √©tape souhaitez-vous ex√©cuter maintenant ?R√©essayerDTJe suis sur windowsü™ü EX√âCUTION SUR WINDOWS
Parfait ! Adaptons l'installation pour Windows. Voici les √©tapes sp√©cifiques.
üìã Pr√©requis Windows
1. Installer les outils n√©cessaires
Option A : Docker Desktop (Recommand√© - Plus Simple)

T√©l√©charger Docker Desktop

Aller sur : https://www.docker.com/products/docker-desktop/
T√©l√©charger Docker Desktop pour Windows
Installer et red√©marrer l'ordinateur


V√©rifier l'installation

powershell   docker --version
   docker-compose --version
Option B : Installation manuelle (Si pas Docker)

Installer Java 17

T√©l√©charger : https://adoptium.net/
Choisir : Temurin 17 (LTS)
Installer et v√©rifier :



powershell   java -version

Installer Maven

T√©l√©charger : https://maven.apache.org/download.cgi
Extraire dans C:\Program Files\Maven
Ajouter au PATH
V√©rifier :



powershell   mvn -version

Installer PostgreSQL

T√©l√©charger : https://www.postgresql.org/download/windows/
Installer (noter le mot de passe)


Installer Redis

T√©l√©charger : https://github.com/microsoftarchive/redis/releases
Ou utiliser WSL2



üöÄ M√âTHODE 1 : AVEC DOCKER DESKTOP (Recommand√©)
√âtape 1 : Pr√©parer le projet
Ouvrez PowerShell en tant qu'administrateur :
powershell# Aller dans le dossier du projet
cd C:\path\to\duty-free-backend

# V√©rifier les fichiers
dir
√âtape 2 : Cr√©er les fichiers de configuration Windows
Cr√©ez un fichier setup.bat :
batch@echo off
REM setup.bat - Configuration initiale pour Windows

echo ========================================
echo   DUTY FREE - SETUP WINDOWS
echo ========================================
echo.

REM Cr√©er les r√©pertoires
echo Creation des repertoires...
if not exist "logs" mkdir logs
if not exist "backups\database" mkdir backups\database
if not exist "backups\files" mkdir backups\files
if not exist "uploads" mkdir uploads
if not exist "ssl" mkdir ssl

REM Copier .env.example vers .env
if not exist ".env" (
    echo Creation du fichier .env...
    copy .env.example .env
    echo ATTENTION: Editez le fichier .env avec vos parametres
) else (
    echo Fichier .env existe deja
)

echo.
echo Setup termine avec succes!
echo.
echo Prochaines etapes:
echo 1. Editez le fichier .env
echo 2. Executez: docker-compose up -d
echo.
pause
√âtape 3 : Cr√©er .env pour Windows
Cr√©ez le fichier .env :
env# Database
DB_NAME=dutyfree_db
DB_USER=postgres
DB_PASSWORD=postgres

# Redis
REDIS_PASSWORD=redis_password

# JWT Secret (g√©n√©rer un nouveau)
JWT_SECRET=MySecretKeyForDutyFreeApplicationThatIsLongEnough123456789ChangeThisInProduction

# Application
SPRING_PROFILES_ACTIVE=dev
TZ=Africa/Ouagadougou

# Nginx
NGINX_HOST=localhost
√âtape 4 : Ex√©cuter le setup
powershell# Ex√©cuter le setup
.\setup.bat
√âtape 5 : D√©marrer avec Docker Desktop
powershell# D√©marrer tous les services
docker-compose up -d

# Voir les logs
docker-compose logs -f
√âtape 6 : V√©rifier que tout fonctionne
powershell# V√©rifier les containers
docker-compose ps

# Health check
curl http://localhost:8080/actuator/health

# Ou avec PowerShell
Invoke-WebRequest -Uri http://localhost:8080/actuator/health
üîß M√âTHODE 2 : SANS DOCKER (D√©veloppement Local)
√âtape 1 : Installer PostgreSQL

T√©l√©charger et installer PostgreSQL 15
Pendant l'installation, noter le mot de passe
Ouvrir SQL Shell (psql)

sql-- Cr√©er la base de donn√©es
CREATE DATABASE dutyfree_db;

-- V√©rifier
\l
√âtape 2 : Installer Redis
Option A : Avec WSL2 (Recommand√©)
powershell# Installer WSL2
wsl --install

# Red√©marrer l'ordinateur

# Dans WSL
sudo apt update
sudo apt install redis-server
redis-server
Option B : Version Windows

T√©l√©charger : https://github.com/microsoftarchive/redis/releases
Extraire et ex√©cuter redis-server.exe

√âtape 3 : Configurer l'application
√âditer src/main/resources/application-dev.yml :
yamlspring:
  datasource:
    url: jdbc:postgresql://localhost:5432/dutyfree_db
    username: postgres
    password: votre_mot_de_passe_postgres
  
  redis:
    host: localhost
    port: 6379
    password: # Laisser vide si pas de password
√âtape 4 : Compiler et ex√©cuter
powershell# Compiler
mvn clean package -DskipTests

# Ex√©cuter
java -jar target/duty-free-backend-1.0.0.jar

# Ou directement
mvn spring-boot:run
üõ†Ô∏è SCRIPTS WINDOWS
start.bat
batch@echo off
echo Demarrage de Duty Free Backend...
docker-compose up -d
echo.
echo Application demarree!
echo Swagger UI: http://localhost:8080/swagger-ui.html
echo.
pause
stop.bat
batch@echo off
echo Arret de Duty Free Backend...
docker-compose down
echo.
echo Application arretee!
pause
logs.bat
batch@echo off
docker-compose logs -f app
backup.bat
batch@echo off
echo Creation d'une sauvegarde...
set BACKUP_FILE=backups\database\dutyfree_db_%date:~-4,4%%date:~-10,2%%date:~-7,2%_%time:~0,2%%time:~3,2%%time:~6,2%.sql
docker-compose exec -T postgres pg_dump -U postgres dutyfree_db > %BACKUP_FILE%
echo Sauvegarde creee: %BACKUP_FILE%
pause
health-check.bat
batch@echo off
echo Verification de la sante de l'application...
echo.

echo Application:
curl -s http://localhost:8080/actuator/health
echo.

echo.
echo Database:
docker-compose exec postgres pg_isready -U postgres
echo.

echo.
echo Redis:
docker-compose exec redis redis-cli ping
echo.

pause
üéØ COMMANDES POWERSHELL UTILES
powershell# D√©marrer l'application
docker-compose up -d

# Voir les logs en temps r√©el
docker-compose logs -f app

# Arr√™ter l'application
docker-compose down

# Red√©marrer
docker-compose restart

# Voir l'√©tat
docker-compose ps

# Acc√©der au shell de l'application
docker-compose exec app sh

# Acc√©der √† PostgreSQL
docker-compose exec postgres psql -U postgres -d dutyfree_db

# Backup de la base de donn√©es
docker-compose exec postgres pg_dump -U postgres dutyfree_db > backup.sql

# Nettoyer tout
docker-compose down -v
docker system prune -f
üß™ TESTER L'API SUR WINDOWS
Avec PowerShell
powershell# Login
$body = @{
    username = "admin"
    password = "admin123"
} | ConvertTo-Json

$response = Invoke-RestMethod -Uri "http://localhost:8080/api/auth/login" -Method Post -Body $body -ContentType "application/json"

# Afficher le token
$response.data.token

# Sauvegarder le token
$token = $response.data.token

# Utiliser le token pour r√©cup√©rer les produits
$headers = @{
    Authorization = "Bearer $token"
}

Invoke-RestMethod -Uri "http://localhost:8080/api/products" -Headers $headers
Avec curl (si install√©)
powershell# Login
curl -X POST http://localhost:8080/api/auth/login -H "Content-Type: application/json" -d "{\"username\":\"admin\",\"password\":\"admin123\"}"

# R√©cup√©rer les produits (remplacer YOUR_TOKEN)
curl -X GET http://localhost:8080/api/products -H "Authorization: Bearer YOUR_TOKEN"
```

### üåê ACC√àS WEB

Ouvrez votre navigateur et allez sur :

1. **Swagger UI**
```
   http://localhost:8080/swagger-ui.html
```

2. **Health Check**
```
   http://localhost:8080/actuator/health
```

3. **PgAdmin (si activ√©)**
```
   http://localhost:5050
üêõ D√âPANNAGE WINDOWS
Probl√®me : Docker Desktop ne d√©marre pas
powershell# V√©rifier WSL2
wsl --status

# Mettre √† jour WSL2
wsl --update

# Red√©marrer Docker Desktop
Probl√®me : Port 8080 d√©j√† utilis√©
powershell# Trouver le processus
netstat -ano | findstr :8080

# Tuer le processus (remplacer PID)
taskkill /PID <PID> /F
Probl√®me : Erreur de permissions
powershell# Ex√©cuter PowerShell en tant qu'administrateur
# Clic droit sur PowerShell > "Ex√©cuter en tant qu'administrateur"
Probl√®me : Docker compose file not found
powershell# V√©rifier que vous √™tes dans le bon dossier
pwd

# V√©rifier que docker-compose.yml existe
dir docker-compose.yml
üìä MONITORING SUR WINDOWS
Cr√©ez monitor.bat :
batch@echo off
:loop
cls
echo ========================================
echo   DUTY FREE - MONITORING
echo ========================================
echo.
echo Containers Status:
docker-compose ps
echo.
echo Application Logs (last 10 lines):
docker-compose logs --tail=10 app
echo.
echo Next refresh in 30 seconds...
timeout /t 30 /nobreak
goto loop
üìù FICHIER DE CONFIGURATION COMPLET
Cr√©ez config.bat pour faciliter la gestion :
batch@echo off
:menu
cls
echo ========================================
echo   DUTY FREE - MENU PRINCIPAL
echo ========================================
echo.
echo 1. Demarrer l'application
echo 2. Arreter l'application
echo 3. Voir les logs
echo 4. Health Check
echo 5. Backup base de donnees
echo 6. Ouvrir Swagger UI
echo 7. Ouvrir PgAdmin
echo 8. Nettoyer tout
echo 9. Quitter
echo.
set /p choice="Choisissez une option (1-9): "

if "%choice%"=="1" goto start
if "%choice%"=="2" goto stop
if "%choice%"=="3" goto logs
if "%choice%"=="4" goto health
if "%choice%"=="5" goto backup
if "%choice%"=="6" goto swagger
if "%choice%"=="7" goto pgadmin
if "%choice%"=="8" goto clean
if "%choice%"=="9" goto end

:start
echo Demarrage...
docker-compose up -d
pause
goto menu

:stop
echo Arret...
docker-compose down
pause
goto menu

:logs
docker-compose logs -f app
goto menu

:health
call health-check.bat
goto menu

:backup
call backup.bat
goto menu

:swagger
start http://localhost:8080/swagger-ui.html
goto menu

:pgadmin
start http://localhost:5050
goto menu

:clean
echo ATTENTION: Cela va supprimer toutes les donnees!
set /p confirm="Continuer? (O/N): "
if /i "%confirm%"=="O" (
    docker-compose down -v
    docker system prune -f
)
pause
goto menu

:end
exit
üöÄ D√âMARRAGE RAPIDE
powershell# 1. Ex√©cuter le setup
.\setup.bat

# 2. √âditer .env si n√©cessaire
notepad .env

# 3. D√©marrer tout
docker-compose up -d

# 4. V√©rifier la sant√©
.\health-check.bat

# 5. Ouvrir Swagger
start http://localhost:8080/swagger-ui.html
‚úÖ CHECKLIST DE V√âRIFICATION

 Docker Desktop install√© et d√©marr√©
 Fichiers .env cr√©√© et configur√©
 docker-compose up -d ex√©cut√© sans erreur
 docker-compose ps montre tous les services "Up"
 http://localhost:8080/actuator/health retourne "UP"
 http://localhost:8080/swagger-ui.html accessible
 Login avec admin/admin123 fonctionne


Dites-moi quelle m√©thode vous pr√©f√©rez (Docker ou local) et o√π vous en √™tes ! üöÄR√©essayerClaude peut faire des erreurs. Assurez-vous de v√©rifier ses r√©ponses. Sonnet 4.5